<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <style type="text/css">
        @font-face {
            font-family: gotham;
            src: url(/gotham-book-regular.otf);
        }

        * {
            font-family: Helvetica Neue;
        }

        a:link,
        a:visited {
            color: #5e3f99;
        }

        input[type=text]:focus {
            border-color: #f68826;
            box-shadow: 0 0 5px #f68826 !important;
        }

        input[type=email]:focus {
            border-color: #f68826;
            box-shadow: 0 0 5px #f68826 !important;
        }

        .sv-root-modern .sv-container-modern {
            color: white !important;
            fill: white !important;
        }
        .sv-radio__svg {
            border-color: white !important;
        }

        .sv-root-modern .sv-radio--checked .sv-radio__svg  {
            fill: white !important;
        }

        .sv-root-modern input.sv-text, textarea.sv-comment, select.sv-dropdown{
            color: white !important;
        }
        
    </style>
    <title>HIT Completed</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>

    <!-- Latest compiled and minified CSS -->
    <!-- Using Bootsawtch theme: https://bootswatch.com/cyborg/ -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">


    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>

    <link href="https://unpkg.com/survey-knockout@1.8.41/modern.css" type="text/css" rel="stylesheet"/>
    <script src="https://unpkg.com/jquery"></script>
    <script src="https://unpkg.com/survey-jquery@1.8.41/survey.jquery.min.js"></script>

    <script type="text/javascript" src='/js/StimToolLib.js'></script>

</head>

<body>

    <div class="container">
        <div class="py-5 text-center">
            <img class="d-block mx-auto mb-4" src="/images/logo_reversed.jpg" alt="" width="180" height="50">
            <h4>You have completed this HIT!</h4>
            <br>
            <p>Thank You for Your Participation!</p>
          </div>
    </div>
    <div class="container">
        <table class="table table-hover">
            <tbody>
                <tr>
                  <th scope="row">ID:</th>
                  <td id="participant">TEST</td>
                </tr>
              </tbody>
        </table>
        <br>
    </div>
    <div class="container" style="color: white;">
        <h5>Your Completion Code:</h5>
        <p>Use the Code below to enter on Mturk to recieve payment.</p>
        <h2 class="text-center" id='mturkcode' style="color: rgb(220, 241, 22);">1234</h2>
        <br>
    </div>
    <div class="container" id='seesion1isntructions' style="color: white; display: none;">
        <h5>Would you like to earn more <b>&#128176;</b>?</h5>
        <p>Please complete session 2 of this HIT to recive an additional <b style="color: rgb(106, 173, 106);font-size: 20px;">$4.00</b> reward.</p>
        <br>
        <h5>Instructions to Complete Session 2:</h5>
        <ol>
            <li>Submit this code for this HIT on Mturk</li>
            <li>Wait for approval and be added to the qualifications.</li>
            <li>Accept and perform the HIT titled: Driving Task - Session 2</li>
        </ol>
        <br>
    </div>
    <div class="container">
        <p>You may exit and close this window at anytime.</p>
    </div>

    

    <div class="jumbotron text-center" style="margin-bottom:0">
        
        <p >&copy; 2021 <a href="http://www.laureateinstitute.org">laureateinstitute.org</a>. All rights reserved.
    </div>

    <script type="text/javascript">
        var expInfo = { 'participant': '' ,'session': '', 'study': '', 'id': getQueryVariable('id') };

        // Get info Promize
        const getInfoPromise = new Promise((resolve, reject) => {
            $.ajax({
                type: "POST",
                url: '/getInfo',
                data: { 'id': expInfo.id },
                dataType: 'JSON',
                success: function (data) {
                    resolve(data)
                }
            })
        })
            // Read getINFO 
            .then((values) => {
                console.log(values)
                if (values.subject && values.session && values.study) {
                    expInfo.participant = values.subject
                    expInfo.study = values.study
                    expInfo.session = values.session
                    expInfo.run_id = getQueryVariable('run')
                }


                $("#participant").text(expInfo.participant);
                $("#session").text(expInfo.session);

                if (expInfo.session == 'T1'){
                    document.getElementById('seesion1isntructions').style.display = 'block';
                }

                $("#study").text(expInfo.study);

            })

        // OLD WAY and NEW WAY. The difference is adding two random single digit integer (0-9) to the end to make it likely that the code is slightly different between sessions.
        //document.getElementById('mturkcode').innerHTML = getQueryVariable('id').split('-')[3].toUpperCase()
        document.getElementById('mturkcode').innerHTML = getQueryVariable('id').split('-')[3].toUpperCase() + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10)

        $.ajax({
                type: "POST",
                url: '/SaveHitCSV',
                data: {
                    "csvpath": "/media/stimtool_online/HIT_CODES/hit_codes.csv",
                    "content": (document.getElementById('mturkcode').innerHTML + ",")
                },
                dataType: 'JSON',
                statusCode: {
                    200: function() {
                        console.log('save HIT CSV success')
                  }
                }
            })


        const getInfoPromise2 = new Promise((resolve, reject) => {
            $.ajax({
                type: "POST",
                url: '/getInfo',
                data: { 'id': expInfo.id },
                dataType: 'JSON',
                success: function (data) {
                    resolve(data)
                }
            })
        }).then((values) => {
            $.ajax({
                    type: "POST",
                    url: '/SaveDevInfo',
                    data: {
                        "csvpath": "/media/stimtool_online/HIT_CODES/device_info.csv",
                        "username": values.subject,
                        "dimensions": `Width-${screen.availWidth} + Height-${screen.availHeight}`,
                        "content": navigator.userAgent.replace(",", "") + "," 
                    },
                    dataType: 'JSON',
                    statusCode: {
                        200: function() {
                            console.log('save HIT CSV success')
                        }
                    }
                })
        })

        // Code for code in query
        if (getQueryVariable('code') && getQueryVariable('mturk')){
            document.getElementById('mturkcode').innerHTML = getQueryVariable('code').toUpperCase();
            document.getElementById('participant').innerHTML = getQueryVariable('mturk').toUpperCase();
            console.log(document.getElementById('participant'))
        }
        
    </script>
    <script src="/js/confetti.js"></script>

</body>

</html>
