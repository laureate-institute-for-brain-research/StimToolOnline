<!DOCTYPE html>
<html lang="en">

<head>
    <style type="text/css">
        @font-face {
            font-family: gotham;
            src: url(/gotham-book-regular.otf);
        }

        * {
            font-family: Helvetica Neue;
        }

        a:link,
        a:visited {
            color: #5e3f99;
        }

        input[type=text]:focus {
            border-color: #f68826;
            box-shadow: 0 0 5px #f68826 !important;
        }

        input[type=email]:focus {
            border-color: #f68826;
            box-shadow: 0 0 5px #f68826 !important;
        }

        .sv-root-modern .sv-container-modern {
            color: white !important;
            fill: white !important;
        }
        .sv-radio__svg {
            border-color: white !important;
        }

        .sv-root-modern .sv-radio--checked .sv-radio__svg  {
            fill: white !important;
        }

        .sv-root-modern input.sv-text, textarea.sv-comment, select.sv-dropdown{
            color: white !important;
        }
        
    </style>
    <title>Post Task Questions</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>

    <!-- Latest compiled and minified CSS -->
    <!-- Using Bootsawtch theme: https://bootswatch.com/cyborg/ -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">


    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>

    <link href="https://unpkg.com/survey-knockout@1.8.41/modern.css" type="text/css" rel="stylesheet"/>
    <script src="https://unpkg.com/jquery"></script>
    <script src="https://unpkg.com/survey-jquery@1.8.41/survey.jquery.min.js"></script>

    <script type="text/javascript" src='/js/StimToolLib.js'></script>

</head>

<body>

    <div class="container" style="max-width: 800px;">
        <div class="py-5 text-center">
            <img class="d-block mx-auto mb-4" src="/images/logo_reversed.jpg" alt="" width="180" height="50">
            <!-- <h4>Cultural Survey</h4> -->
          </div>
    </div>

    <div class="container" style="max-width: 800px;">
        <div class="row" >
            <div id="surveyElement" style="max-width: 800px; width: 770px; margin-bottom:40px"></div>
            
            <div id="surveyResult"></div>
        </div>
    </div>

    <div class="jumbotron container" style="margin-bottom:0;max-width: 400px;">
        <table class="table table-hover">
            <tbody>
                <tr>
                  <th scope="row">ID:</th>
                  <td><a id="participant"></a></td>
                </tr>
                <tr>
                    <th scope="row">Session:</th>
                    <td><a id="session"></a></td>
                  </tr>
                  <tr>
                    <th scope="row">Study:</th>
                    <td><a id="study"></a></td>
                  </tr>
              </tbody>
        </table>
        <p style="text-align: center;">&copy; 2021 <a href="http://www.laureateinstitute.org">laureateinstitute.org</a>. All rights reserved.</p>
    </div>

    <script type="text/javascript">

        Survey
            .StylesManager
            .applyTheme("modern");
        // Survey.Survey.cssType = "bootstrap";
        // Survey.defaultBootstrapCss.navigationButton = "btn";
        var json = {
                    "title": "Medical and Psychiatric History",
                    "logoPosition": "right",
                    "pages": [
                     {
                      "name": "page1",
                      "elements": [
                       {
                        "type": "radiogroup",
                        "name": "question1",
                        "title": "Have you ever been diagnosed with major depressive disorder?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question3",
                        "title": "If applicable, what is the severity of your major depressive disorder diagnosis?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Mild"
                         },
                         {
                          "value": "Item 2",
                          "text": "Moderate"
                         },
                         {
                          "value": "Item 4",
                          "text": "Severe"
                         },
                         {
                          "value": "Item 5",
                          "text": "Unsure"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question4",
                        "title": "Have you ever been diagnosed with generalized anxiety disorder?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question6",
                        "title": "Have you ever been diagnosed with obsessive compulsive disorder?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question8",
                        "title": "Have you ever been diagnosed with post-traumatic stress disorder?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question10",
                        "title": "Have you ever been diagnosed with an eating disorder (e.g., anorexia, bulimia, binge eating)?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question12",
                        "title": "If applicable, what type of eating disorder were you diagnosed with?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Anorexia"
                         },
                         {
                          "value": "Item 2",
                          "text": "Bulimia"
                         },
                         {
                          "value": "Item 3",
                          "text": "Binge eating"
                         },
                         {
                          "value": "Item 4",
                          "text": "Other"
                         },
                         {
                          "value": "Item 5",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question14",
                        "title": "Have you ever been diagnosed with a substance use disorder (e.g., alcohol use disorder, opioid use disorder, stimulant use disorder)?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question13",
                        "title": "What type of substance use disorder were you diagnosed with?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Alcohol use"
                         },
                         {
                          "value": "Item 2",
                          "text": "Stimulant use (e.g., amphetamines, cocaine, etc.)"
                         },
                         {
                          "value": "Item 3",
                          "text": "Opioid use"
                         },
                         {
                          "value": "Item 4",
                          "text": "Other"
                         },
                         {
                          "value": "Item 5",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question16",
                        "title": "Have you ever been diagnosed with social anxiety disorder?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question18",
                        "title": "Have you ever been diagnosed with panic disorder?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question20",
                        "title": "Have you ever been diagnosed with agoraphobia?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question22",
                        "title": "Have you ever been diagnosed with bipolar disorder?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question25",
                        "title": "If applicable, what type of bipolar disorder were you diagnosed with? ",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Type 1"
                         },
                         {
                          "value": "Item 2",
                          "text": "Type 2"
                         },
                         {
                          "value": "Item 3",
                          "text": "Unspecified"
                         },
                         {
                          "value": "Item 4",
                          "text": "Other"
                         },
                         {
                          "value": "Item 6",
                          "text": "Unsure"
                         },
                         {
                          "value": "Item 5",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question26",
                        "title": "Have you ever been diagnosed with schizophrenia?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 5",
                          "text": "Prefer not to answer"
                         }
                        ]
                       }
                      ],
                      "description": "The following questions ask about your mental health history. These questions are completely optional. You do not have to share specific mental health information to participate in this study. If so, you may select \"prefer not to answer\" for each question."
                     },
                     {
                      "name": "page2",
                      "elements": [
                       {
                        "type": "radiogroup",
                        "name": "question27",
                        "title": "Have you ever been diagnosed with epilepsy?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question28",
                        "title": "Do you have a history of seizures?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question29",
                        "title": "Have you ever had a stroke?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question30",
                        "title": "Have you ever lost consciousness for more than 30 minutes due to a head injury?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question31",
                        "title": "Do you have persistent memory or attention difficulties?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       }
                      ],
                      "description": "The following questions ask about your physical health history. These questions are completely optional. You do not have to share medical information to participate in this study."
                     },
                     {
                      "name": "page3",
                      "elements": [
                       {
                        "type": "radiogroup",
                        "name": "question32",
                        "title": "Have you taken an SSRI (e.g., Prozac, Zoloft, Lexapro) in the past six weeks?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question33",
                        "title": "Have you taken an SNRI (e.g., Pristiq, Cymbalta, Effexor) in the past six weeks?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question34",
                        "title": "Have you taken an antipsychotic (e.g., Risperdal, Abilify, Seroquel) in the past six weeks?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question35",
                        "title": "Have you taken an anticonvulsant (e.g., Neurontin, Topamax, Lamictal) in the past six weeks?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question36",
                        "title": "Have you taken a stimulant (e.g., Adderall, Vyvanse, Modafinil) in the past six weeks?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "radiogroup",
                        "name": "question37",
                        "title": "Have you taken a benzodiazapine (e.g., Xanax, Valium, Ativan, Klonopin) in the past six weeks?",
                        "isRequired": true,
                        "choices": [
                         {
                          "value": "Item 1",
                          "text": "Yes"
                         },
                         {
                          "value": "Item 2",
                          "text": "No"
                         },
                         {
                          "value": "Item 3",
                          "text": "Prefer not to answer"
                         }
                        ]
                       },
                       {
                        "type": "text",
                        "name": "question38",
                        "title": "Have you taken any other medications related to your mental or neurological health in the past six weeks?",
                        "isRequired": true
                       }
                    ]
                   }
                   ]
                   }

        window.survey = new Survey.Model(json);


        // Recor the response time or how long they spent on a page
        lastpage = survey.currentPage;
        function timerLoop(elapsed) {
            var page = survey.currentPage; // page variable is the currentPage on the survey
            if (!page) return;
            if (lastpage != page) {
                // set new start date
                start = new Date().getTime(); // sets new start Date object when page has changed.
                lastpage = page // sets the last page to currente page 

            }
            var valueName = "TRQ" + survey.pages.indexOf(page);

            var ms = survey.getValue(valueName); // gets the value of the valuename. e.g: TRQ1

            if (ms == null) ms = 0;
            else ms = elapsed;
            survey.setValue(valueName, ms);
            $('#timeEl').text(elapsed + ' ms');
        }


        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split('&');
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split('=');
                if (decodeURIComponent(pair[0]) == variable) {
                    return decodeURIComponent(pair[1]);
                }
            }
            return 'NULL'
        }

        survey.showProgressBar = "bottom";

        survey.goNextPageAutomatic = false
        survey.showNavigationButtons = true;
        survey.showCompletedPage = false;

        // Get Query Variables
        var surveyname = getQueryVariable('survey');

        var expInfo = { 'participant': '' ,'session': '',  'task': surveyname, 'date' : formatDate(), 'study': '', 'id': getQueryVariable('id') };

        // Get info Promize
        const getInfoPromise = new Promise((resolve, reject) => {
            $.ajax({
                type: "POST",
                url: '/getInfo',
                data: { 'id': expInfo.id },
                dataType: 'JSON',
                success: function (data) {
                    resolve(data)
                }
            })
        })
            // Read getINFO 
            .then((values) => {
                console.log(values)
                if (values.subject && values.session && values.study) {
                    expInfo.participant = values.subject
                    expInfo.study = values.study
                    expInfo.session = values.session
                    expInfo.run_id = getQueryVariable('run')
                }

                survey.onComplete.add(function (result) {
                    //result.preventDefault();
                    postSurveyData(result.data, expInfo.session, expInfo.participant);
                });

                $("#surveyElement").Survey({model: survey});
    
                $("#participant").text(expInfo.participant);
                $("#session").text(expInfo.session);
                $("#study").text(expInfo.study);

            })

        function postSurveyData(data, session, mkturkid) {
            console.log('/link?id=' + expInfo.id  + '&index=' + (parseInt(getQueryVariable('index')) + 1))
            $.ajax({
                type: "POST",
                url: '/save',
                data: {
                    "trials_data": data,
                    "expInfo": expInfo
                },
                dataType: 'JSON',
                statusCode: {
                    200: function() {
                        console.log('sucess saved on backend')
                        console.log('/link?id=' + expInfo.id  + '&index=' + (parseInt(getQueryVariable('index')) + 1))
                        window.location.replace('/link?id=' + expInfo.id  + '&index=' + (parseInt(getQueryVariable('index')) + 1))
                    }
                }
            }) 
                
        }

        var start = new Date().getTime(),
            elapsed = '0.0';

        // executes timerCallback every 100 ms
        timerID = window.setInterval(function () {

            var time = new Date().getTime() - start;
            elapsed = Math.floor(time);

            //alert(elapsed);
            //$('#timeEl').text(elapsed + ' ms');

            //displayTime(1);
            timerLoop(elapsed);

        }, 5);
    </script>

</body>

</html>
