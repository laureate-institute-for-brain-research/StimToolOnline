<!DOCTYPE html>
<html>
    <head>
        <title>PHQ Survey</title>
        <script src="https://unpkg.com/jquery"></script>
        <script src="/bundles/prettydiff?v=E3KTA7j8SjgR8NaAhm1jADBJxbWj5Yx1GQ2EdHBzuxE1"></script>

        <script src="https://unpkg.com/survey-jquery@0.12.10/survey.jquery.min.js"></script>

        <link rel="stylesheet" href="https://unpkg.com/bootstrap@3.3.7/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="./index.css">

    </head>
    <body>
        <div style="position: fixed; left : 50% ;  background-color: #ff9900;"><center><p id="mkId"></p></center><p id="timeOutput"></p></div>
        <br>
       
        <div id="surveyElement"></div>
        <div id="surveyResult"></div>
        

        <script type="text/javascript">

        	
        	Survey.Survey.cssType = "bootstrap";
			Survey.defaultBootstrapCss.navigationButton = "btn btn-green";

            var json = {pages:[{elements:[{type:"radiogroup",choices:[{value:"0",text:"Male"},{value:"1",text:"Female"}],isRequired:true,name:"question1",title:"Gender"},{type:"radiogroup",choices:[{value:"0",text:"Hispanic or Latino"},{value:"1",text:"Not Hispanic or Latino"}],isRequired:true,name:"question2",title:"Ethnic Category"},{type:"checkbox",name:"question3",visible:false,visibleIf:"{question2} = '1'",title:"Racial Categories (check all that apply)",choices:["Alaskan Native","Asian","Black or African American","Native American","Native Hawaiian or Other Pacific Islander","White","Other Race or Ethnicity"]},{type:"text",name:"question4",title:"If you were born and/or raised outside of the United States, how old were you when you came to the United States?"},{type:"text",name:"question5",title:"What languages do you speak fluently?"},{type:"radiogroup",choices:[{value:"0",text:"Yes"},{value:"1",text:"No"}],name:"question6",title:"Is English your primary language?"},{type:"radiogroup",choices:[{value:"0",text:"Yes"},{value:"1",text:"No"}],isRequired:true,name:"question7",title:"Did you speak a language other than English at home when you were growing up?"},{type:"radiogroup",choices:[{value:"0",text:"Yes"},{value:"1",text:"No"}],isRequired:true,name:"question8",title:"Were you raised in an intact family of origin?"},{type:"radiogroup",choices:[" Single"," Married"," Divorced"," Separated"," Widowed"," Significant Other"," Other"],isRequired:true,name:"question9",title:"Marital Status"},{type:"dropdown",choices:["0","1","2","3","4","5","6","7","8","9","10"],isRequired:true,name:"question10",title:"How many biological children do you have?"},{type:"radiogroup",choices:[" Mobile home"," One-family house detached from any other house"," One-family house attached to one or more houses"," Building with 2 or more apartments"," Boat, RV, van, etc."," Other"],isRequired:true,name:"question11",title:"What best describes the building where you currently live?"},{type:"radiogroup",choices:["No schooling completed","Nursery school","Kindergarten","Grade 1 through 11","12th grade (no diploma)","Regular high school diploma","GED or alternative credential","Some college credit, but less than 1 year of college credit","1 or more years of college credit, no degree","Associate's degree (for example: AA, AS)","Bachelor's degree (for example: BA, BS)","Master's degree (for example: MA, MS, MEng, MEd, MSW, MBA)","Professional degree beyond a bachelor's degree (for example: MD, DDS, DVM, LLB, JD)","Doctorate degree (for example: PhD, EdD)"],isRequired:true,name:"question12",title:"What is the highest degree or level of school you have completed?"},{type:"radiogroup",choices:["Legislators and Senior Officials","Corporate Managers","General Managers","Physical, Mathematical and Engineering Science Professionals","Life Science and Health Professionals","Teaching Professionals","Other Professionals","Physical and Engineering Science Associate Professionals","Life Science and Health Associate Professionals","Teaching Associate Professionals","Other Associate Professionals","Office Clerks","Customer Service Clerks","Personal and Protective Services Workers","Models, Salespersons and Demonstrators","Market-oriented Skilled Agricultural and Fishery Workers","Subsistence Agricultural and Fishery Workers","Extraction and Building Trade Workers","Metal, Machinery and Related Trade Workers","Precision, Handicraft, Printing and Related Trade Workers","Other Craft and Related Trade Workers","Stationary Plant and Related Operators","Machine Operators and Assemblers","Drivers and Mobile Plant Operators","Sales and Services Elementary Occupations","Agricultural, Fishery and Related Laborers","Laborers in Mining, Construction, Manufacturing and Transport","Armed Forces","Unemployed","Disabled","Other"],isRequired:true,name:"question13",title:"What kind of work do you normally do?"},{type:"text",name:"question14",title:"Please describe:",visibleIf:"{question13} == 'Other'"},{type:"text",name:"question15",title:"If you are not currently working, how long has it been (in days) since the last time you had a paid job?"},{type:"radiogroup",choices:["Fired","Laid off","Plant/company closed","Quit","Retired","Work force reduction","Return to school","Other"],name:"question16",title:"Why did you leave your last job?"},{type:"text",name:"question17",title:"Please Describe",visibleIf:"{question17} = 'Other'"},{type:"radiogroup",choices:[{value:"0",text:"Yes"},{value:"1",text:"No"}],isRequired:true,name:"question18",title:"Insurance through current or former employer"},{type:"radiogroup",choices:[{value:"0",text:"Yes"},{value:"1",text:"No"}],isRequired:true,name:"question19",title:"Insurance purchased directly from an insurance company"},{type:"radiogroup",choices:[{value:"0",text:"Yes"},{value:"1",text:"No"}],isRequired:true,name:"question20",title:"Medicare, for people 65 and older, or people with certain disabilities"},{type:"radiogroup",choices:[{value:"0",text:"Yes"},{value:"1",text:"No"}],isRequired:true,name:"question21",title:"Medicaid, Medical Assistance, or any kind of government-assistance plan for those with low incomes or a disability"},{type:"radiogroup",choices:[{value:"0",text:"Yes"},{value:"1",text:"No"}],isRequired:true,name:"question22",title:"TRICARE or other military health care"},{type:"radiogroup",choices:[{value:"0",text:"Yes"},{value:"1",text:"No"}],isRequired:true,name:"question23",title:"Veteran's Administration health care"},{type:"radiogroup",choices:[{value:"0",text:"Yes"},{value:"1",text:"No"}],isRequired:true,name:"question24",title:"Indian Health Service"},{type:"text",isRequired:true,name:"question25",title:"Any other type of health insurance or health coverage plan. Please describe:"},{type:"radiogroup",choices:[" Never served in the military"," Only on active duty for training in the Reserves or National Guard"," Now on active duty"," On active duty in the past, but not now"],isRequired:true,name:"question26",title:"Have you ever served on active duty in the U.S. Armed Forces, Reserves or National Guard?"},{type:"text",name:"question27",title:"Branch"},{type:"text",name:"question28",title:"Years of Service"},{type:"text",name:"question29",title:"Highest Rank Achieved"},{type:"radiogroup",choices:[" A. Less than $0 (loss)"," B. $0 (None)"," C. $1 - $999"," D. $1,000 - $1,999"," E. $2,000 - $2,999"," F. $3,000 - $3,999"," G. $4,000 - $4,999"," H. $5,000 - $5,999"," I. $6,000 - $6,999"," J. $7,000 - $7,999"," K. $8,000 - $8,999"," L. $9,000 - $9,999"," M. $10,000 - $10,999"," N. $11,000 - $11,999"," O. $12,000 - $12,999"," P. $13,000 - $13,999"," Q. $14,000 - $14,999"," R. $15,000 - $15,999"," S. $16,000 - $16,999"," T. $17,000 - $17,999"," U. $18,000 - $18,999"," V. $19,000 - $19,999"," W. $20,000 - $24,999"," X. $25,000 - $29,999"," Y. $30,000 - $34,999"," Z. $35,000 - $39,999"," AA. $40,000 - $44,999"," BB. $45,000 - $49,999"," CC. $50,000 - $74,999"," DD. $75,000 - $99,999"," EE. $100,000 - $149,999"," FF. $150,000 - $199,999"," GG. $200,000 - $299,999"," HH. $300,000 - $499,999"," II. $500,000 - $999,999"," JJ. $1,000,000 or more"],isRequired:true,name:"question30",title:"Which best represents your household income in the past 12 months, before taxes?"},{type:"radiogroup",choices:[{value:"0",text:"Yes"},{value:"1",text:"No"}],isRequired:true,name:"question31",title:"Have you ever received public assistance or welfare since turning 18, such as id to Families with Dependent Children, General Assistance, or Temporary Assistance for Needy Families?"}],name:"page1"}]}




			window.survey = new Survey.Model(json);

            // Parse the URL 

            var loc = window.location;

            var session = loc.search.split("&")[0].replace("?","").split("=")[1]
            // Secnd element of the split by &
            var mkturkid = loc.search.split("&")[1].replace("?","").split("=")[1]
            

            //console.log(loc)

            //alert(mkturkid)

			survey.onComplete
			    .add(function (result) {
			        postSurveyData(JSON.stringify(result.data), mkturkid, elapsedTime);
                    // similar behavior as clicking on a link
                    window.location.href = "http://localhost:1185/?session="+session+"&mkturk_id= "+mkturkid+"&survey=phq";
			    });

			$("#surveyElement").Survey({model: survey});


            var  elapsedTime = 0;
            var delay = 100;


            // Increase variable every 100 ms
            // Display the elapsed time on the very top
            setInterval(function() {
                elapsedTime = elapsedTime + delay;
                $('#timeOutput').text('Time Spent on Survey: (in ms): ' + elapsedTime );
                $("#mkId").text(mkturkid);
            }, delay);


            function postSurveyData(data,mkturkid, elapsedTime){
                $.ajax({
                    type: 'POST',
                    url: '/saveSurvey/',
                    data: elapsedTime+data, // or JSON.stringify ({name: 'jonas'}),
                    success: function(data) { alert('data: ' + data); },
                    contentType: "application/json",
                    dataType: 'json'
                });
            }







            function saveToFile(data, mkturkid, elapsedTime){
                var xmlhttp;
                var date = new Date()
                var file_date = date.getFullYear() + "_" + date.getMonth() + "_" +date.getDate() + "_" + date.getHours() + date.getMinutes()
                
                //var user = prompt("Please Enter your Name:");
                var file_name = "SURVEY-DEMO-"+ mkturkid + "-" + file_date + ".csv"

                var head1 = 'elapsedTime: ' + elapsedTime + '\n'
                
                //https://stackoverflow.com/questions/26961750/write-server-text-files-with-ajax
                if (window.XMLHttpRequest)
                     {// code for IE7+, Firefox, Chrome, Opera, Safari
                          xmlhttp=new XMLHttpRequest();
                          }
                else
                      {// code for IE6, IE5
                            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                            }
                xmlhttp.onreadystatechange=function()
                  {
                        if (xmlhttp.readyState==4 && xmlhttp.status==200)
                            {
                                console.log('Saved the files dude')
                                //alert("Thank You! Your data has been recorded")
                                }
                  }

                xmlhttp.open("POST","phpwrite2.php",true);
                xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
                xmlhttp.send("name="+file_name+"&content="+head1+data+"\n")
            }

        </script>

         

    </body>
</html>